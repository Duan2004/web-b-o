(()=>{"use strict";const t=864e5,e="https://api.moneyoyo.org/api",n="mnyy_adk",i="mnyy_cdk",r="MISSING_ENV_VAR".HISTORICAL_DB_PREFIX||"mnyy_hrs_",o=Number("MISSING_ENV_VAR".HISTORICAL_DB_AUTO_COMPACT_PERIOD||t),s=Number("MISSING_ENV_VAR".HISTORICAL_DB_MAX_SIZE||100),a=Number("MISSING_ENV_VAR".HISTORICAL_DB_DEFAULT_RANGE_LIMIT||30*t),c="brs",u="dpl",l="clk",d="mnyy_bsk",p="900",f="/mnyy-notification",h="BD7eO3kmJ7Pun2C39NA8CAtxq2ylQIZHR6B-ufD80YQqDGqfZ-NB4wpYReLR6Uh1EySIheatnsEDk2C9qyjnQLM",m=(Number("0.5"),Number("1000"),Number("MISSING_ENV_VAR".VIDEO_VISIBLE_RATE||.5),Number("MISSING_ENV_VAR".VIDEO_VISIBLE_TIME||3e3),Number("MISSING_ENV_VAR".VIDEO_VIEW_TIME||25e3),Number("MISSING_ENV_VAR".NATIVE_ADS_VISIBLE_RATE||.5),Number("MISSING_ENV_VAR".NATIVE_ADS_VISIBLE_TIME||1e3),Number("MISSING_ENV_VAR".SHOW_POWERED_BY_MINIMUM_LEVEL||50),"0.39.1"),g=()=>location.href.includes("mnyy_debug=1"),v={isDebug:()=>g(),debug(...t){g()&&console.log(...t)},info(...t){console.log(...t)},error(...t){console.error(...t)},warn(...t){console.warn(...t)},alertDebug(t){g()&&alert(t)}};function b(t,e,n){if(!n)return t;const i=t.includes("?")?"&":"?";return`${t}${i}${e}=${encodeURIComponent(n)}`}var w=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const y=window.__mnyyFetch||window.fetch;function S(t,n){if(n&&n.params)for(const e in n.params)t=b(t,e,n.params[e]);return t.startsWith("http://")||t.startsWith("https://")||(t=`${e}${t}`),y(t,n)}function k(){return{fetch:S,fetchJSON(t,e){return w(this,void 0,void 0,(function*(){const n=yield S(t,e);return yield n.json()}))},post(t,e,n){return w(this,void 0,void 0,(function*(){return(yield S(t,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},mode:"cors",body:JSON.stringify(e),params:n})).json()}))},postPlainText(t,e,n){return w(this,void 0,void 0,(function*(){return(yield S(t,{method:"POST",headers:{"Content-Type":"text/plain"},mode:"cors",body:JSON.stringify(e),params:n})).json()}))}}}function I(t,e,n=null){if(!t||"object"!=typeof t)return n;for(e=Array.isArray(e)?e:e.split(".");e.length;){let i=e.shift();if(!i||!t[i])return n;t=t[i]}return t}function x(t,e=""){return A(t,{defaultValue:e,searchInput:document.currentScript?document.currentScript.src:""})}function A(t,{defaultValue:e="",searchInput:n=window.location.search}={}){if(n.startsWith("http")){return new URL(n).searchParams.get(t)||e}return new URLSearchParams(n).get(t)||e}function D(t){let e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild}function _(){return t=navigator.userAgent,/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4));var t}function T(){return(t=navigator.userAgent)&&t.toLowerCase().includes("firefox");var t}function N(){return(t=navigator.userAgent)&&t.toLowerCase().includes("safari")&&!t.toLowerCase().includes("chrome");var t}function E(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),i=new Uint8Array(n.length);for(let t=0;t<n.length;++t)i[t]=n.charCodeAt(t);return i}function P(t){return new Promise((e=>setTimeout(e,t)))}var C=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function O(t,e=k()){return{newUser(){return C(this,arguments,void 0,(function*(n=""){try{const{data:i}=yield e.fetchJSON("/v1/public/cols/nu",{params:{pid:t,uid:n},credentials:"include"});return i}catch(t){return void v.error(t)}}))},collectBrowsing(n){return C(this,void 0,void 0,(function*(){try{const{data:i}=yield e.postPlainText("/v1/public/cols/bh?pv=1",n,{pid:t});return i}catch(t){return void v.error(t)}}))},collectPageView(n,i){return C(this,void 0,void 0,(function*(){try{return yield e.postPlainText(`/v1/public/cols/pv/${n}`,i,{pid:t}),!0}catch(t){return v.error(t),!1}}))},collectSession(n,i){return C(this,void 0,void 0,(function*(){try{return yield e.postPlainText(`/v1/public/cols/ss/${n}`,i,{pid:t}),!0}catch(t){return v.error(t),!1}}))}}}var V=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function R(t,e,n){return V(this,void 0,void 0,(function*(){var i;const r=Array.from(t.document.querySelectorAll('script[type="application/ld+json"]')).map((t=>{try{let e=t.innerText.trim().replace("};","}");return JSON.parse(e)}catch(t){return null}})).find((t=>t&&"NewsArticle"==t["@type"])),o={thumbnail:W(r),title:$(z(r)),description:$(M(r)),createdAt:j(r),createdDate:U()};if(o.title)return O(e).collectBrowsing(Object.assign(Object.assign({},n),{referer:null===(i=location.href)||void 0===i?void 0:i.replace(/\/+$/,""),pageInfo:o}))}))}function z(t){if(null==t?void 0:t.headline)return t.headline;const e=window.document.querySelector('meta[property="og:title"]');return(null==e?void 0:e.getAttribute("content"))||(document.querySelector("title")||{innerText:""}).innerText}function M(t){if(null==t?void 0:t.description)return null==t?void 0:t.description;const e=window.document.querySelector("meta[name=description]"),n=window.document.querySelector('meta[property="og:description"]');return(null==n?void 0:n.getAttribute("content"))||(null==e?void 0:e.getAttribute("content"))||""}function W(t){var e,n;const i=null!==(n=null===(e=window.document.querySelector('meta[property="og:image"]'))||void 0===e?void 0:e.getAttribute("content"))&&void 0!==n?n:"";if(!(null==t?void 0:t.image))return i;let r=Array.isArray(t.image)?t.image[0]:t.image;return r="string"==typeof r?r:null==r?void 0:r.url,"string"!=typeof r?(console.warn("Strange article image properties: "+typeof r),i):r||i}function j(t){var e;let n=B(null==t?void 0:t.datePublished);if(!n){const i=(null===(e=window.document.querySelector('meta[property="article:published_time"]'))||void 0===e?void 0:e.getAttribute("content"))||"";n=B(i),n||console.info("Strange article published time format: "+(null==t?void 0:t.datePublished)+", "+i)}return n}function B(t){if(!t)return null;t=t.replace(" ","T");try{return L(t)}catch(t){}if(t.includes("T"))return B(t.split("T")[0]);if(t.match(/\d{4}-\d{2}-\d{2}/))try{return L(t)}catch(t){return null}const e=Number.parseInt(t);return!Number.isNaN(e)&&e>14200704e5&&e<=(new Date).getTime()?L(e):null}function L(t){const e=new Date(t);return isNaN(e.getTime())?null:e.getTime()>(new Date).getTime()?(new Date).toISOString():e.toISOString()}function U(){var t;const e=null===(t=window.document.body.innerText)||void 0===t?void 0:t.match(/\d{2}\/\d{2}\/2\d{3}[\n\s]/);return e?L(e[0].trim().split("/").reverse().join("-")):null}function q(t){if(!v.isDebug())return;let e=A("mnyy_debug_endpoint");e&&e.startsWith("http")&&t().then((t=>k().fetch(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include",body:JSON.stringify(t)}))).then(v.debug).then(v.error)}function $(t){if(!t)return t;t=G(t);try{const e=/^[\da-f]{2}$/i,n=/^[\da-f]{4}$/i,i=t.length;let r,o,s=0,a="";for(;s<i;){if(r=t.charAt(s++),"%"===r)if("u"===t.charAt(s)){if(o=t.slice(s+1,s+5),n.exec(o)){a+=String.fromCharCode(parseInt(o,16)),s+=5;continue}}else if(o=t.slice(s,s+2),e.exec(o)){a+=String.fromCharCode(parseInt(o,16)),s+=2;continue}a+=r}return a}catch(e){return console.error(e),t}}function G(t){try{const e=document.createElement("textarea");return e.innerHTML=t,e.value}catch(e){return console.error(e),t}}function J(t){let e="";for(let n=0;n<t.length-1;n+=2)e+=t[n+1]+t[n];return t.length%2==1&&(e+=t.charAt(t.length-1)),e}function Y(t){let e="";for(let n=0;n<t.length;n++)e+=t.charCodeAt(n).toString(16).padStart(2,"0");return e}function H(t){return btoa(t).replace(/=/g,"")}const Z={encode:function(t,e=""){if(""===t)return"";const n=J(H(t)),i=H(Y(e)+n),r=Math.floor(i.length/2),o=i.substring(0,r);return i.substring(r)+o},decode:function(t,e=""){if(""===t)return"";const n=Math.ceil(t.length/2),i=t.substring(0,n),r=t.substring(n),o=atob(r+i),s=Y(e);if(!o.startsWith(s))throw new Error("invalid data");const a=J(o.substring(s.length));return atob(a)}},F=1,K="guest";class X{constructor(t){this.data=t}static instance(){if(X._instance)return X._instance;try{const t=JSON.parse(localStorage.getItem(n));if(t&&t.__v){const e=JSON.parse(Z.decode(t.data,i));if(e)return new X(e)}}catch(t){v.error("Cannot process store data",t)}const t=new X({dataVersion:F,userID:"",subscriptionEndpoint:"",lastSaveSubscription:0});return t.save(),X._instance=t}get isGuest(){return"granted"!=Notification.permission}setUserID(t){t!=K&&(this.data.userID=t,this.data.userIDExpire=Date.now()+7776e6,this.save())}get userID(){return this.data.userID||""}get userIDExpire(){return this.data.userIDExpire||0}setSubscriptionEndpoint(t){this.data.subscriptionEndpoint=t,this.save()}get subscriptionEndpoint(){return this.data.subscriptionEndpoint}setLastSaveSubscription(t){this.data.lastSaveSubscription=t,this.save()}get lastSaveSubscription(){return this.data.lastSaveSubscription}static bulkWrite(t){const e=X.instance();try{e.pausedSave=!0,t(e)}finally{e.pausedSave=!1,e.save()}}save(){if(this.pausedSave)return;const t={__v:F,data:Z.encode(JSON.stringify(this.data),i)};localStorage.setItem(n,JSON.stringify(t))}}const Q=X;var tt,et,nt;function it(t){return`${d}${t.split("").reverse().join("")}`}!function(t){t.Approved="approved"}(tt||(tt={})),function(t){t.Website="website",t.NativePush="native_push",t.NativeAds="native_ads",t.BannerAds="banner_ads",t.VideoAds="video_ads"}(et||(et={})),function(t){t.tracked="tracked",t.notTracked="notTracked",t.tracking="tracking"}(nt||(nt={}));class rt{constructor(t,e){this.zoneType=t,this.data=e}static instance(t){if(rt._instanceByScope[t])return rt._instanceByScope[t];try{const e=JSON.parse(sessionStorage.getItem(it(t)));if(e&&e.startedAt&&Date.now()-e.startedAt<1e3*Number(p))return new rt(t,e)}catch(t){v.error(t)}const e=new rt(t,{startedAt:Date.now(),status:nt.notTracked});return e.save(),rt._instanceByScope[t]=e}get isNotTracked(){return this.data.status===nt.notTracked}startTrack(){this.data.status=nt.tracking,this.save()}cancelTrack(){this.data.status=nt.notTracked,this.save()}markTracked(){this.data.status=nt.tracked,this.data.trackedAt=Date.now(),this.save()}save(){sessionStorage.setItem(it(this.zoneType),JSON.stringify(this.data))}}rt._instanceByScope={[et.NativePush]:void 0,[et.NativeAds]:void 0,[et.BannerAds]:void 0,[et.VideoAds]:void 0,[et.Website]:void 0};const ot=rt;class st{constructor(){this._listeners={}}on(t,e,n=!1){return Array.isArray(this._listeners[t])||(this._listeners[t]=[]),v.debug("Registering callback for event: "+t),this._listeners[t].push({callback:e,once:n}),this}once(t,e){return this.on(t,e,!0),this}emit(t,...e){if(v.debug("Emitting event: "+t,e),!Array.isArray(this._listeners[t]))return;const n=[];this._listeners[t].forEach((i=>{if("object"==typeof i&&"function"==typeof i.callback)return i.callback(...e),void(i.once?v.debug("Removed once listener for event: "+t,i):n.push(i));v.debug("Invalid listener for event: "+t,i)})),this._listeners[t]=n}}const at=st;function ct(t){return new Promise(((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)}))}function ut(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const i=ct(n);return(t,n)=>i.then((i=>n(i.transaction(e,t).objectStore(e))))}let lt;function dt(){return lt||(lt=ut("keyval-store","keyval")),lt}function pt(t,e=dt()){return e("readonly",(e=>ct(e.get(t))))}function ft(t,e,n=dt()){return n("readwrite",(n=>(n.put(e,t),ct(n.transaction))))}function ht(t,e,n=dt()){return n("readwrite",(n=>new Promise(((i,r)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),i(ct(n.transaction))}catch(t){r(t)}}}))))}function mt(t,e=dt()){return e("readwrite",(e=>(e.delete(t),ct(e.transaction))))}function gt(t,e=dt()){return e("readwrite",(e=>(t.forEach((t=>e.delete(t))),ct(e.transaction))))}function vt(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ct(t.transaction)}function bt(t=dt()){return t("readonly",(e=>{if(e.getAll&&e.getAllKeys)return Promise.all([ct(e.getAllKeys()),ct(e.getAll())]).then((([t,e])=>t.map(((t,n)=>[t,e[n]]))));const n=[];return t("readonly",(t=>vt(t,(t=>n.push([t.key,t.value]))).then((()=>n))))}))}var wt=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const yt="main",St="_internal";class kt{constructor(t,e=yt){const n=indexedDB.open(t);n.onupgradeneeded=()=>{n.result.createObjectStore(e),n.result.createObjectStore(St)},this.dbp=ct(n),this.customStore=(t,n)=>this.dbp.then((i=>n(i.transaction(e,t).objectStore(e))))}getItem(t){return wt(this,void 0,void 0,(function*(){return pt(t,this.customStore)}))}setItem(t,e){return wt(this,void 0,void 0,(function*(){return ft(t,e,this.customStore)}))}updateItem(t,e){return wt(this,void 0,void 0,(function*(){return ht(t,e,this.customStore)}))}updateConfig(t){return wt(this,void 0,void 0,(function*(){return ht("config",t,((t,e)=>this.dbp.then((n=>e(n.transaction(St,t).objectStore(St))))))}))}getConfig(){return wt(this,void 0,void 0,(function*(){return pt("config",((t,e)=>this.dbp.then((n=>e(n.transaction(St,t).objectStore(St))))))}))}delItem(...t){return wt(this,void 0,void 0,(function*(){if(0!=t.length)return 1==t.length?mt(t[0],this.customStore):gt(t,this.customStore)}))}entries(){return wt(this,void 0,void 0,(function*(){return bt(this.customStore)}))}}var It=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const xt=30,At=30;class Dt{constructor(t,e){e=Object.assign({maxSize:s},e),this.maxSize=e.maxSize;try{this.idbStorage=new kt(r+t)}catch(e){console.warn(e),console.error(new Error(`error opening idb ${t}`))}}static instance(t){return this._instance[t]?this._instance[t]:new Dt(t)}static click(){return Dt.instance(l)}static display(){return Dt.instance(u)}static browsing(){return Dt.instance(c)}track(t){return It(this,void 0,void 0,(function*(){try{return this.trackAt(t,Date.now())}catch(t){console.warn(t)}}))}getConfig(){return It(this,void 0,void 0,(function*(){if(this.idbStorage)return this.idbStorage.getConfig()}))}trackAt(t,e){return It(this,arguments,void 0,(function*(t,e,n=xt){if(!this.idbStorage)return;if(!t)return;const i={at:e};yield this.idbStorage.updateItem(t,(t=>t?(t.histories.push(i),t.histories.sort(((t,e)=>t.at-e.at)),t.histories.length>n&&(t.histories=t.histories.slice(t.histories.length-n)),t.lastAt=t.histories[t.histories.length-1].at,t.times+=1,t):{histories:[i],lastAt:i.at,times:1}));let r=0;yield this.idbStorage.updateConfig((t=>{if(!t){const t=Date.now();return{lastAutoCompact:t,lastTrackAt:e,createdAt:t,dirtyTrack:1,trackTimes:1,env:{RANGE_LIMIT:a,MAX_SIZE:this.maxSize,AUTO_COMPACT_PERIOD:o}}}return t.trackTimes=(t.trackTimes||0)+1,t.dirtyTrack=(t.dirtyTrack||0)+1,r=t.dirtyTrack,t.lastTrackAt=e,t})),r>this.maxSize&&(console.warn("Auto compact triggered by exceeding dirty reads!"),yield this.autoCompact())}))}getExcludes(t){return It(this,void 0,void 0,(function*(){if(!this.idbStorage)return[];try{t=Object.assign({limit:At,range:a},t),yield this.autoCompact();const e=yield this.idbStorage.entries();if(e.length<=t.limit)return e.map((t=>t[0]));e.sort(((t,e)=>t[1].lastAt-e[1].lastAt));const n=Date.now()-t.range;return e.slice(e.length-t.limit).filter((t=>t[1].lastAt>=n)).map((t=>t[0]))}catch(t){return console.warn(t),[]}}))}getRecentTimestamps(t){return It(this,void 0,void 0,(function*(){if(!this.idbStorage)return{};if(null==t)return{};try{if(!(t=Object.assign({limit:At,range:a},t)).feq)return{};yield this.autoCompact();const e=yield this.idbStorage.entries();e.sort(((t,e)=>e[1].lastAt-t[1].lastAt));const n={},i=Date.now()-t.range;let r=0;for(const o of e){const[e,s]=o;if(s.lastAt<i)break;let a=s.histories;if(s.histories.length>t.feq&&(a=s.histories.slice(s.histories.length-t.feq)),a=a.filter((t=>t.at>=i)),a.length){if(n[e]=a.map((t=>t.at)),r>=t.limit)break;r++}}return n}catch(t){return console.warn(t),{}}}))}autoCompact(){return It(this,arguments,void 0,(function*(t=a,e=o){if(this.idbStorage)try{let n=!1;if(yield this.idbStorage.updateConfig((t=>{if(!t){const t=Date.now();return{lastAutoCompact:t,lastTrackAt:0,createdAt:t,trackTimes:0,env:{RANGE_LIMIT:a,MAX_SIZE:this.maxSize,AUTO_COMPACT_PERIOD:o}}}return(t.lastAutoCompact||0)<Date.now()-e&&(n=!0,t.lastAutoCompact=Date.now(),t.dirtyTrack=0),t})),n)return this.compact(t)}catch(t){console.warn(t)}}))}compact(t){return It(this,void 0,void 0,(function*(){let e=yield this.idbStorage.entries(),n=[];for(const i of e){const[e,r]=i;r.lastAt<Date.now()-t&&n.push(e)}if(yield this.idbStorage.delItem(...n),e.length-n.length<this.maxSize)return;const i=e.length-Math.floor(.8*this.maxSize);return e=yield this.idbStorage.entries(),e.sort(((t,e)=>t[1].lastAt-e[1].lastAt)),n=e.slice(0,i).map((t=>t[0])),this.idbStorage.delItem(...n)}))}}Dt._instance={};var _t=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};if(!e||!e.startsWith("http"))throw new Error("APE is not set");window.mnyyUit=window.mnyyUit||{};const Tt="mnyyApp",Nt="trackedPageView",Et={initUser(t){return _t(this,void 0,void 0,(function*(){const e=Q.instance();if(e.userID&&!e.userID.startsWith("_tmp")&&e.userIDExpire>Date.now())return;const n=yield O(t.pid).newUser(e.userID),i=(null==n?void 0:n.userID)||`_tmp_${Date.now()}`;e.setUserID(i)}))},init(t){const e=t.app||Tt;window[e]||(window.MNYYAppGlobals=window.MNYYAppGlobals||[],window.MNYYAppGlobals.push(e),window[e]={v:m,initialized:!1,pid:"",websiteID:"",categoryID:0,trackedPageView:!1,eventEmitter:new at});const n=window[e];if(t.onTrackedPageView&&(n.trackedPageView?t.onTrackedPageView():n.eventEmitter.once(Nt,t.onTrackedPageView)),n.initialized)return;n.initialized=!0,n.pid=t.pid,n.websiteID=t.websiteID,n.categoryID=t.categoryID;const i=["mousedown","mousemove","keydown","scroll","touchstart"],r=window.top;function o(){return _t(this,void 0,void 0,(function*(){if(r.mnyyUit[e])return;r.mnyyUit[e]=!0,v.debug("uited "+e),i.forEach((function(t){r.document.removeEventListener(t,o)}));const t=Q.instance(),s=yield R(r,n.pid,{websiteID:n.websiteID,categoryID:n.categoryID,userID:t.userID,guest:t.isGuest});s&&(n.trackedPageView=!0,n.eventEmitter.emit(Nt)),yield Dt.browsing().track(s.path);const a=ot.instance(et.Website);if(a.isNotTracked){a.startTrack();const e={websiteID:n.websiteID,userID:t.userID};if(yield O(n.pid).collectSession(et.Website,e))return void a.markTracked();a.cancelTrack()}}))}i.forEach((function(t){r.document.addEventListener(t,o,{once:!0})}))}},Pt=JSON.parse('{"Would you like to receive notifications on latest news?":"คุณต้องการรับข่าวสารล่าสุดจาไหม","Yes":"ตกลง","No":"ไม่, ขอบคุณ"}'),Ct={vi:JSON.parse('{"Would you like to receive notifications on latest news?":"Bạn có muốn nhận thông báo về những bài viết mới?","Yes":"Đồng ý","No":"Từ chối"}'),th:Pt};function Ot(t){return function(e){return I(Ct,[t,e],e)}}var Vt=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Rt(t=k()){return{getNativePushZone(e,n){return Vt(this,void 0,void 0,(function*(){try{const{data:i}=yield t.fetchJSON("/v1/public/zones/native_push",{params:{pid:e,hostname:n}});return i}catch(t){return void console.log(t)}}))},getZone(e,n,i){return Vt(this,void 0,void 0,(function*(){try{const{data:r}=yield t.fetchJSON(`/v1/public/zones/${n}`,{params:{pid:e,hostname:i}});return r}catch(t){return void console.log(t)}}))}}}var zt=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Mt(t,e=k()){return{subscribe(n){return zt(this,void 0,void 0,(function*(){try{const{data:i}=yield e.post("/v1/public/clients/subscriptions",n,{pid:t});return i}catch(t){return void v.error(t)}}))}}}var Wt=function(t,e,n,i){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?n(t.value):r(t.value).then(s,a)}c((i=i.apply(t,e||[])).next())}))};if(!h)throw new Error("WASK is not defined");const jt="mnyy_slide_prompt",Bt=x("pid"),Lt=x("aglb"),Ut=Ot(x("lang","vi")),qt=new at,$t={notificationUnsupported:"notificationUnsupported",registerServiceWorkerFailed:"registerServiceWorkerFailed",alreadyDenied:"alreadyDenied",pressedAllowButton:"pressedAllowButton",permissionAllowed:"permissionAllowed",permissionDefault:"permissionDefault",permissionDenied:"permissionDenied",slidePromptConfirmed:"slidePromptConfirmed",slidePromptCanceled:"slidePromptCanceled"};qt.on($t.permissionAllowed,(()=>{v.info("permissionAllowed")}));const Gt={pid:Bt,serviceWorker:"/mnyy-service-worker.js",swScope:void 0,tags:{swCount:0,swRegistrations:[],bRef:document.referrer},slidePrompt:{enable:!1,text:"Would you like to receive notifications on latest news?",iconUrl:"https://cdn.moneyoyo.org/upload/PdjiEBY.png",acceptButtonText:"Yes",denyButtonText:"No",delayShow:0,sleepTime:6048e5},subscription:{multiple:!1}};let Jt;const Yt={unlocked:!1,overlayScheduled:!1,permissionRequesting:!1};function Ht(){return Wt(this,void 0,void 0,(function*(){yield Et.initUser({pid:Bt});const e=Q.instance(),n=Rt();if(Jt=yield n.getNativePushZone(Bt,location.hostname),!Jt||!Jt.id)return void v.warn("Native push zone not found, stopped.");if(Et.init({pid:Bt,app:Lt,websiteID:Jt.websiteID,categoryID:Jt.categoryID,onTrackedPageView:()=>{const t=O(Bt),n={websiteID:Jt.websiteID,userID:e.userID};t.collectPageView(et.NativePush,n).then(v.debug);const i=ot.instance(et.NativePush);i.isNotTracked&&(i.startTrack(),t.collectSession(et.NativePush,n).then((t=>{t?i.markTracked():i.cancelTrack()})))}}),!Jt.active||!Jt.config)return void v.warn("Native push inactivated or missing config, stopped.");Jt.config=Zt(Gt,Jt.config);const i=Jt.config.serviceWorker;if(0!=i.lastIndexOf("/")&&(Jt.config.swScope=i.substring(0,i.lastIndexOf("/"))+f),q((function(){return Wt(this,void 0,void 0,(function*(){const t=Dt.browsing(),n=yield t.getConfig();return{pid:Bt,sdkVersion:"v1",sdk:"webpush",permission:(window.Notification||{}).permission,nativePushZone:Jt,subscriptionEndpoint:e.subscriptionEndpoint,userID:e.userID,oldestVisitedTime:null==n?void 0:n.createdAt,lastVisitedTimes:null==n?void 0:n.lastTrackAt,histories:yield t.getExcludes({limit:t.maxSize}),jsCookie:document.cookie}}))})),Jt.config.serviceWorker)try{const n=yield Ft(Jt.config.serviceWorker);if(te()){if(Date.now()-e.lastSaveSubscription<t)return;return Kt(n)}if(ee())return void qt.emit($t.alreadyDenied);if(Jt.config.subscription.multiple&&(v.debug("Multiple subscription enabled, wait 10s and continue."),yield P(1e4)),!ne())return Kt(n);if(re())return;if(!(yield oe(Jt.config.slidePrompt)))return;return Kt(n)}catch(t){v.error(t)}else v.error("Service worker option must be exist!")}))}function Zt(t,e){if(!e)return t;let n=t.slidePrompt,i=t.tags;return(t=Object.assign({},t,e)).tags=Object.assign({},i,t.tags),t.slidePrompt=Object.assign({},n,t.slidePrompt),t}function Ft(t){return Wt(this,void 0,void 0,(function*(){if(!("serviceWorker"in navigator))return qt.emit($t.notificationUnsupported),Promise.reject("Service workers aren't supported in this browser.");try{const e=yield navigator.serviceWorker.getRegistrations();return Jt.config.tags.swCount=e.length,Jt.config.tags.swCount>0&&(Jt.config.tags.swRegistrations=e.map((function(t){return{scope:t.scope,swUrl:t.active?t.active.scriptURL:null}}))),yield navigator.serviceWorker.register(t,{scope:Jt.config.swScope||f,updateViaCache:"none"})}catch(t){throw qt.emit($t.registerServiceWorkerFailed),t}}))}function Kt(t){return Wt(this,void 0,void 0,(function*(){if(!Yt.permissionRequesting){Yt.permissionRequesting=!0;try{const e=yield Notification.requestPermission();if("denied"===e)return void qt.emit($t.permissionDenied);if("default"===e)return void qt.emit($t.permissionDefault);qt.emit($t.pressedAllowButton);const n={userVisibleOnly:!0,applicationServerKey:E(h)},i=yield t.pushManager.subscribe(n);yield Xt(i),Q.bulkWrite((t=>{t.setSubscriptionEndpoint(i.endpoint),t.setLastSaveSubscription(Date.now())})),qt.emit($t.permissionAllowed)}catch(t){v.warn("Subscribe Error:",t),qt.emit($t.permissionDenied)}finally{Yt.permissionRequesting=!1}}}))}function Xt(t){return Wt(this,void 0,void 0,(function*(){return Mt(Bt).subscribe({languages:Qt(),tags:Jt.config.tags,userID:Q.instance().userID,subscription:t,websiteID:Jt.websiteID,zoneID:Jt.id,referer:location.href})}))}function Qt(){return navigator?navigator.languages?navigator.languages:navigator.language?[navigator.language]:[]:[]}function te(){return"granted"===Notification.permission}function ee(){return"denied"===Notification.permission}function ne(){return Jt.config.slidePrompt.enable||ie()}function ie(){return T()||N()}function re(){const t=Number(localStorage.getItem(jt));return!!t&&(new Date).getTime()-t<Jt.config.slidePrompt.sleepTime}function oe(t){return new Promise((e=>{setTimeout((()=>{var n,i,r,o,s,a,c,u,l;let d=ce();document.body.appendChild(d),null===(i=null===(n=d.contentWindow)||void 0===n?void 0:n.document)||void 0===i||i.write(ue(t)),null===(s=null===(o=null===(r=d.contentWindow)||void 0===r?void 0:r.document)||void 0===o?void 0:o.querySelector("#slp-container #slp-allow-button"))||void 0===s||s.addEventListener("click",(()=>{se(),ae(),qt.emit($t.slidePromptConfirmed),e(!0)})),null===(u=null===(c=null===(a=d.contentWindow)||void 0===a?void 0:a.document)||void 0===c?void 0:c.querySelector("#slp-container #slp-cancel-button"))||void 0===u||u.addEventListener("click",(()=>{se(),ae(),qt.emit($t.slidePromptCanceled),e(!1)})),null===(l=d.contentWindow)||void 0===l||l.document.close(),_()?d.style.bottom="0px":d.style.top="0px"}),1e3*t.delayShow)}))}function se(){localStorage.setItem(jt,(new Date).getTime().toString())}function ae(){Array.from(document.querySelectorAll(".mnyy-slp-iframe")).forEach((t=>t.remove()))}function ce(){return D(`<iframe class="mnyy-slp-iframe" scrolling="no" frameborder="0" sandbox=" allow-same-origin allow-modals allow-forms allow-orientation-lock allow-popups allow-popups-to-escape-sandbox allow-scripts allow-top-navigation"\n            style="font-size: 14px;position: fixed;z-index: 2258594000;${_()?"bottom":"top"}: -300px;left: 50%;width: 100%;max-width: 500px;min-height: 165px;transition: all .8s ease-in-out;-webkit-font-smoothing: initial;transform: translate(-50%, 0);box-shadow:rgba(0, 0, 0, 0.16) 0 10px 36px 0, rgba(0, 0, 0, 0.06) 0 0 0 1px;"></iframe>`)}function ue({text:t,iconUrl:e,acceptButtonText:n,denyButtonText:i}){return`<style>body{margin:0}#slp-container{font-size:14px}#slp-container #slp-dialog .clearfix{display:block;clear:both;-webkit-backface-visibility:initial!important;backface-visibility:initial!important}#slp-container #slp-dialog{height: 100%;box-sizing:border-box;width:500px;max-width:100%;margin:0 auto;background:#fff!important;padding:18px;border-bottom-left-radius:2px;border-bottom-right-radius:2px;font-family:Roboto,Noto,Helvetica Neue,Helvetica,Arial,sans-serif;display: flex;flex-direction: column;justify-content: space-between}#slp-container #slp-dialog .slp-body-icon{box-sizing:border-box;float:left;width:80px;height:80px;position:relative}#slp-container #slp-dialog .slp-body-message{box-sizing:border-box;padding:0 .2em 0 1.286em;float:left;width:calc(100% - 80px);font-size:1.143em;line-height:1.45em;-o-user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;color:rgb(100, 116, 139)!important;max-height:5.8rem;overflow:hidden}#slp-container #slp-dialog .slp-body-icon img{width:100%;height:100%}#slp-container #slp-dialog .slp-footer{position:relative}#slp-container #slp-dialog button{box-sizing:border-box;display:inline-block;padding:.375rem 1rem;font-size:.9625em;font-weight:400;line-height:1.5;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid transparent;border-radius:.25rem;font-family:inherit;letter-spacing:.05em;transition:background-color 75ms;margin:0}#slp-container #slp-dialog .slp-button{padding:.714em 1.4em;font-size:1em;text-transform:uppercase;border-radius:2px;font-weight:400}#slp-container #slp-dialog .slp-button.primary{box-shadow:rgba(0, 0, 0, 0) 0 0 0 0, rgba(0, 0, 0, 0) 0 0 0 0, rgba(0, 0, 0, 0.1) 0 1px 3px 0, rgba(0, 0, 0, 0.1) 0 1px 2px -1px;border-radius:5px;background:rgb(37, 99, 235)!important;color:rgb(248, 250, 252)!important}#slp-container #slp-dialog .slp-button.secondary{box-shadow:none;background:#fff!important;color:rgb(37, 99, 235)!important}#slp-container #slp-dialog .align-right{float:right}</style>\n<div id="slp-container" class="slp-container">\n    <div id="slp-dialog" class="slp-dialog">\n        <div class="slp-body">\n            ${e?'<div class="slp-body-icon"><img alt="icon" class="" src="'+e+'"></div>':""}\n            <div class="slp-body-message">${Ut(t)}</div>\n            <div class="clearfix"></div>\n        </div>\n        <div class="slp-footer">\n            <button id="slp-allow-button" class="align-right primary slp-button">${Ut(n)}</button><button id="slp-cancel-button" class="align-right secondary slp-button">${Ut(i)}</button>\n            <div class="clearfix"></div>\n        </div>\n    </div>\n</div>`}window.MNYYWebPushSDK={init:Ht,on:qt.on,serviceWorkerUri:()=>Jt.config.serviceWorker},x("lazy")||Ht().then((()=>{v.debug("MNYYWebPushSDK auto init complete.")}))})();